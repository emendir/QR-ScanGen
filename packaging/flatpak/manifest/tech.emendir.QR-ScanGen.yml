app-id: tech.emendir.QR-ScanGen
runtime: org.kde.Platform
runtime-version: "6.9"
sdk: org.kde.Sdk
base: "com.riverbankcomputing.PyQt.BaseApp"
base-version: "6.9"
command: qr-scangen
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=network
  # - --socket=system-bus
  # - --system-talk-name=org.freedesktop.NetworkManager
  # - --talk-name=org.freedesktop.portal.Clipboard
  # - --system-talk-name=org.freedesktop.portal.Clipboard
  - --filesystem=xdg-desktop
  - --filesystem=xdg-download
  - --filesystem=xdg-documents
  - --filesystem=xdg-pictures
  - --filesystem=xdg-public-share
  - --share=ipc
  - --device=all # for camera via opencv
modules:
  - name: ImageMagick
    buildsystem: autotools
    sources:
      - type: archive
        url: https://imagemagick.org/archive/releases/ImageMagick-7.1.1-28.tar.xz
        sha256: ee4b6cdaaf2fa6020b6a3c6e055d993e970361a2fadf2bf2f984308b35c61915
  - name: libzbar
    buildsystem: autotools
    sources:
      - type: archive
        url: https://linuxtv.org/downloads/zbar/zbar-0.23.93.tar.gz
        sha256: 78ae427a529f0399561bc198de5c2c7ca3f11d05fa9e903e65e501168433d218
  - generated_modules/python3-modules-auto.yml
  - name: qr-scangen
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation --prefix=/app --no-deps .
      - install -D packaging/share/tech.emendir.QR-ScanGen.desktop /app/share/applications/tech.emendir.QR-ScanGen.desktop
      - install -D packaging/flatpak/manifest/tech.emendir.QR-ScanGen.metainfo.xml /app/share/metainfo/tech.emendir.QR-ScanGen.metainfo.xml
      - install -D src/qr_scangen/Icon.svg /app/share/icons/hicolor/scalable/apps/tech.emendir.QR-ScanGen.svg
    sources:
      - type: git
        url: https://github.com/emendir/QR-ScanGen
        tag: v1.4.2
      # - type: dir
      #   path: ../../..

